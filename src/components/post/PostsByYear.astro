---
import { getCollection } from "astro:content";
import { type Post, published } from "@/lib/post-utils";
import PostsListItem from "@/components/post/PostsListItem.astro";

const posts: Post[] = await getCollection("blog", published);

const posts_by_year = posts.reduce(
  (acc, curr) => {
    const year = curr.data.publishedAt.getFullYear();
    const group = acc[year] || [];

    return {
      ...acc,
      [year]: [...group, curr] as Post[],
    };
  },
  {} as { [key: string]: Post[] }
);

const years = Object.keys(posts_by_year).sort((a, b) => Number(b) - Number(a));
---

<div class="flex flex-col">
  {
    years.map((year) => (
      <div class="flex flex-col py-2 mt-4 border-t sm:flex-row">
        <div class="w-full py-1 mb-8 font-mono text-bold sm:w-2/12">
          [{year}]
        </div>
        <ul class="flex flex-col list-none w-full sm:w-10/12">
          {posts_by_year[year].map((post: Post) => (
            <PostsListItem {...post} />
          ))}
        </ul>
      </div>
    ))
  }
</div>
